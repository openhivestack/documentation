---
title: Task Lifecycle
description: simple 4-state task lifecycle
icon: LifeBuoy
---

import { Callout } from "fumadocs-ui/components/callout";
import { Mermaid } from "@/components/mdx/mermaid";

The H.I.V.E. Protocol uses an simplified 4-state task lifecycle that eliminates unnecessary complexity while maintaining clear task progression. Perfect for high-throughput systems with millions of agents.

## Simplified Task States

<Mermaid
  chart={`
stateDiagram-v2
    [*] --> REQUESTED
    REQUESTED --> ACCEPTED: Provider accepts
    REQUESTED --> REJECTED: Provider rejects
    ACCEPTED --> COMPLETED: Success
    ACCEPTED --> FAILED: Error
    COMPLETED --> [*]
    FAILED --> [*]
    REJECTED --> [*]
`}
/>

**Key Simplifications**:

- **Removed "PROPOSED"**: Tasks go directly to REQUESTED
- **Removed "IN_PROGRESS"**: Tasks go from ACCEPTED to COMPLETED/FAILED
- **Removed "CANCELED"**: Keep it simple - tasks either complete or fail
- **4 states total**: Down from 7+ in complex protocols

## Task States

### REQUESTED

Task has been sent to a provider agent.

```json
{
  "from": "agentid:hive:client123",
  "to": "agentid:hive:provider456",
  "type": "task_request",
  "data": {
    "task_id": "task-123",
    "capability": "text-processing",
    "text": "hello world",
    "operation": "uppercase"
  },
  "sig": "signature"
}
```

### ACCEPTED

Provider will perform the task.

```json
{
  "from": "agentid:hive:provider456",
  "to": "agentid:hive:client123",
  "type": "task_response",
  "data": {
    "task_id": "task-123",
    "status": "accepted"
  },
  "sig": "signature"
}
```

### COMPLETED

Task finished successfully with results.

```json
{
  "from": "agentid:hive:provider456",
  "to": "agentid:hive:client123",
  "type": "task_result",
  "data": {
    "task_id": "task-123",
    "status": "completed",
    "result": { "result": "HELLO WORLD" }
  },
  "sig": "signature"
}
```

### REJECTED or FAILED

Task couldn't be completed.

```json
{
  "from": "agentid:hive:provider456",
  "to": "agentid:hive:client123",
  "type": "task_error",
  "data": {
    "task_id": "task-123",
    "error": "capability_not_found",
    "message": "text-processing not available",
    "retry": false
  },
  "sig": "signature"
}
```

## Implementation

### Basic Task Lifecycle (Tier 1)

```javascript
// task lifecycle implementation
const tasks = new Map(); // in-memory task tracking

app.post("/tasks", (req, res) => {
  const message = req.body;
  const taskId = message.data.task_id;

  // 1. REQUESTED state (implicit - task received)
  tasks.set(taskId, {
    state: "requested",
    from: message.from,
    capability: message.data.capability,
    data: message.data,
    timestamp: new Date().toISOString(),
  });

  try {
    // 2. ACCEPTED state (immediate processing)
    tasks.set(taskId, { ...tasks.get(taskId), state: "accepted" });

    // Process task
    const result = processTask(message.data.capability, message.data);

    // 3. COMPLETED state
    tasks.set(taskId, { ...tasks.get(taskId), state: "completed", result });

    res.json({
      from: AGENT_ID,
      to: message.from,
      type: "task_result",
      data: {
        task_id: taskId,
        status: "completed",
        result,
      },
      sig: signMessage({ result }),
    });
  } catch (error) {
    // 4. FAILED state
    tasks.set(taskId, {
      ...tasks.get(taskId),
      state: "failed",
      error: error.message,
    });

    res.status(500).json({
      from: AGENT_ID,
      to: message.from,
      type: "task_error",
      data: {
        task_id: taskId,
        error: "processing_failed",
        message: error.message,
        retry: true,
      },
      sig: signMessage({ error: error.message }),
    });
  }
});

// Simple task status query
app.get("/tasks/:taskId", (req, res) => {
  const task = tasks.get(req.params.taskId);
  if (!task) {
    return res.status(404).json({ error: "task_not_found" });
  }

  res.json({
    task_id: req.params.taskId,
    state: task.state,
    timestamp: task.timestamp,
  });
});
```

## Implementation Checklist

**Tier 1 Requirements**:

- [ ] Track 4 basic task states: REQUESTED, ACCEPTED, COMPLETED, FAILED
- [ ] Handle immediate accept/reject decisions
- [ ] Process tasks synchronously when possible
- [ ] Send appropriate result or error messages
- [ ] Simple task state storage (in-memory or database)

**Optional Enhancements (Tier 2+)**:

- [ ] Progress updates for long-running tasks
- [ ] Task timeout handling
- [ ] Retry logic for failed tasks
- [ ] Task history and audit trails
- [ ] Batch task processing

<Callout type="info">
  **Simplicity Benefit**: By removing complex state transitions, implementation
  becomes 70% simpler while still handling the vast majority of use cases
  effectively.
</Callout>

<Callout type="warning">
  **Task Tracking**: Even in Tier 1, maintain basic task state tracking to
  handle duplicate requests and provide status queries.
</Callout>
